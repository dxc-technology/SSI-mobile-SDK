package com.dxc.ssi.agent.didcomm.model.issue


import com.dxc.ssi.agent.utils.indy.IndySerializationUtils.jsonProcessor
import com.dxc.ssi.agent.wallet.indy.model.issue.IndyCredentialDefinition
import kotlinx.serialization.decodeFromString
import kotlinx.serialization.encodeToString
import kotlin.test.Test
import kotlin.test.assertEquals

class CredentialContainerDefinitionTest {

    @Test
    fun testDeserialization() {

        val credDefJson =
            "{\"ver\":\"1.0\",\"id\":\"LU5zaRL1j9DFVJbVUfDyuK:3:CL:21:default\",\"schemaId\":\"21\",\"type\":\"CL\",\"tag\":\"default\",\"value\":{\"primary\":{\"n\":\"120763015657863138817005302589004682170237964122557724040805829827382604627616808045877855580857579809016461824768744323960225153208271787407886120633839055884236274624337311545668029038852615245908124199939460500189204581073810916711308705507908727595742227756230413778295253877585922040464486335971181076436677485926793707478537178908973247335139021740208870212068906132508659881840311185634942522139898768783534391222474815449839255367336077938416448016934400983629176163638886031303663866354643593035060258623466217376057960576198337155477121047502205481649810905673902430224403737158637779638503415480987930851257\",\"s\":\"61317478678735631287705178285515334196152744945999304026363224391345288923096255849714911282482315117487185736018140236415981029981874272594360296475015095116578510949092102257806411416457188316546408661829205760373869135553550144813686936398142406834276539289051792343995424678802842305518086431286325259331000486194885465079437956908096771539386406835175092802186387994631069542879005221551972859564838376549970399609794599497392568812977790063983340872903375836445207467691517059021917983919494565882428120653269384761751335977548195626025529263867972910925707974093758861135529581832864521509412163289105827461733\",\"r\":{\"name\":\"94723210758534581562259474873037151248671475690985043924014857477334727349522822890979023267065846513861823289251122127359638034188823992871956109510248096784271032345926157504909253680342520667152328964948438953472262072616111657391533707922690530621376072241510653432163623915289310129184226137316354096017828004100760765866131153184373337748418011929652405481232999353777389641963545500867578767633597827101842809181087885304591679086010730261947797995622794217038431533817395530060606981427728514014924051257542876967355868531517827332411067504998561554452892740211961163197718385245918325281087156925892163667785\",\"vaccination\":\"83047467507975574005262287230607958818734726794015167277677339578141677578842058267135798748400308117835218436631929715258503418437780622503782540103458328763836958975177618449888645731074157391127531009901680589939435082976559130114073455771550246118858128051413742099841507007939379885657263593003792719407756371445684218862701758760530777076895293649276435972108948641473761055378984254341200174751107456456118280329284493499650170010119994617255788367137757379971093178439923840463562338495282726227657548369573021333654323040880698366196272528318116766091574549192710655313084500705419773120059184885349978921415\",\"age\":\"79933832799951896948102418242377929847126908701830487020735542869979602366114877261998044729082307642215390156090335117631554203045556798600119250188063199023289154987131563699204320451778707148459171042401592735567392191847279222286051655294203894400702092575256575681895170980314003694022975926847962680367205735564134177559597784802832556268463674576744843184303222686965804741275906023594969789674742186787474520201788705288270817868127138893691464416106276028677935691978736235763331599506156942157323434095761590027644444102814203064248208439766412892700924127504920576623988411318145344056359442888627583549363\",\"master_secret\":\"6200162055244403224980784883999823336101850241094989897836072896448192174767309278060369565822984980776602394053896220797576585223172900559746995176638818233139054500122741336193204802572114700950507074393461172130478282495696495602058555122870980291883695934344500822424643108423687444914124338768824871139749471951767792022740110772557328035340695893386613688656508265960114837967261431242206599366821039836542176999507700598651384590616145971936257992479710561937798830591078106987685250653480294395711995125277132436721057688920514827260844630426890791647560150081622807664407794570513524276989208653224859236274\"},\"rctxt\":\"76351637297909150097142424659651195439148100101587666948584794945668472880598605786299371997308378273062584623196522623333228206811406716611320797658116055603538538778390393378512738544893636840398048203624745210262066341607587070715699397109844617522520727091345116424242435843126381377704017396900077064361014113960514349878048495411577000503780320856117972694240462169046429542847610516817511849055233985329016527453437264364164495915778053565277853649329679572395146469296451916925044662784295552635004060109612952735232337516839334896252224184078773020122127068563770947056358049055333057889487980184261143119787\",\"z\":\"74066321994119347895280978326286251969758504674775847611254829826622365324379989009248872157340249800813626082430819052674136494677604216735465999025866142353542177566827614187157059938853444299318344448223332449925213033162437231120396203684639497582382695354627801413338751824795258026958387027093673484157769711348935805683532153199216567055754742565837011130777532909617104861467410928706449763237465372203570540526681107786097382267912263760232725926528227611040959546788380585492646138570914313411345703717013629829496149631335027330713283993030568061642783270507653081942423792039543795943613521933686918595147\"},\"revocation\":null}}"

        println("raw cred def: $credDefJson")

     //   val jsonElement = Json.parseToJsonElement(credDefJson)


     //   println("parsed json element: $jsonElement")

        val credDef = jsonProcessor.decodeFromString<IndyCredentialDefinition>(credDefJson)

        println("parsed cred def: $credDef")

        val encodeToString = jsonProcessor.encodeToString(credDef)

        println("serialized back cred def: $credDef")

        assertEquals(credDefJson, encodeToString)
    }
/*
    @Test
    fun testSerialization() {
        val credentialDefinition =
            CredentialDefinition(
                ver = "1", id = "1", schemaSeqNo = "1", type = "1", tag = "tag",
                value = CredentialPubKeys(primary = JsonElement("{\"n\":\"1\"}"), revocation = null)
            )

        val encodeToString = Json { }.encodeToString(credentialDefinition)

        println(encodeToString)
    }
    */

}